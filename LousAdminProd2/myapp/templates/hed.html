<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>Header</title>
    <link rel="stylesheet" href="{% static 'hed.css' %}?v1.1">
    <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
          integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
          crossorigin="anonymous" referrerpolicy="no-referrer">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Dosis:wght@200..800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Jost:ital,wght@100;200;300;400;500;600;700&display=swap"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@100..900&display=swap"
          rel="stylesheet">
</head>
<body>
<div class="overlay" id="overlay"></div>

<!-- Header -->
<header class="header1">
    <a href="hed.html" class="logo1">Vibe & Vogue</a>
    <ul class="navmenu1" id="navmenu">
        <li><a class="item active" href="#home">Home</a></li>
        <li><a class="item" href="#products">Products</a></li>
        <li><a class="item" href="#categories">Categories</a></li>
        <li><a class="item" href="#about">About Us</a></li>
    </ul>
    <div class="nav-icon1">
        <a href="#" class="search1"><i class='bx bx-search'></i></a>
        <a href="/prof-page/"><i class='bx bx-user'></i></a>
        <a href="/favor-me/"><i class='bx bx-heart'></i></a>
        <a href="/cart/" class="cart-icon">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false" role="img">
                <path d="M8.25 8.25V6a2.25 2.25 0 012.25-2.25h3a2.25 2.25 0 110 4.5H3.75v8.25a3.75 3.75 0 003.75 3.75h9a3.75 3.75 0 003.75-3.75V8.25H17.5"
                      stroke="currentColor" stroke-width="1.5"/>
            </svg>
            <span class="cart-count">{{ cart_count }}</span>
        </a>
        <div class="bx bx-menu" id="menu-icon"></div>
    </div>
</header>

<div class="search-overlay" id="searchOverlay">
    <div class="close-icon" id="close-icon"><i class='bx bx-x'></i></div>
    <a href="/" class="logo-box">Vibe & Vogue</a>
    <div class="search2">
        <input type="text" placeholder="Search..." id="searchInput">
        <button class="clear-btn" id="clearBtn">Delete</button>
    </div>
    <div class="popular-queries">
        <p>Popular Search Terms</p>
        <ul>
            <li class="search-item" data-query="bag">bag</li>
            <li class="search-item" data-query="cosmetic bag">cosmetic bag</li>
            <li class="search-item" data-query="backpack">backpack</li>
            <li class="search-item" data-query="strap">strap</li>
            <li class="search-item" data-query="sneakers">sneakers</li>
        </ul>
    </div>
    <h1 class="new-class-arriv">New Arrivals</h1>
    <div class="products">
        {% for product in new_arrivals %}
        <a href="{% url 'product_detail' product.pk %}" class="product-card-link">
            <div class="product-card">
                <div class="image-container">
                    <img src="{{ product.get_image }}" alt="{{ product.title }}" loading="lazy">
                    <div class="favor-btn">
                    <span class="favorite-btn" data-id="{{ product.id }}">
                        <i class='bx bx-heart'></i>
                    </span>
                    </div>
                </div>
                <div class="cont-des">
                    <h2>{{ product.title }}</h2>
                    <p class="price">${{ product.price }}</p>
                </div>
                <p class="description">{{ product.description }}</p>
                <span class="add-to-bag" data-product-id="{{ product.id }}">Add to Bag</span>
            </div>
        </a>
        {% endfor %}
    </div>
</div>

<div class="side-menu" id="side-menu">
    <div class="close-icon" id="close1"><i class='bx bx-x'></i></div>

    {% if user.is_authenticated %}
    <div class="profile">
        {% if profile.profile_image %}
        <img src="{{ profile.profile_image.url }}" alt="Profile" class="avatar">
        {% else %}
        <img src="{% static 'image/Profile.png' %}" alt="Profile" class="avatar">
        {% endif %}
        <a href="/prof-page/"><h2>{{ user.first_name }} {{ user.last_name|slice:":1" }}.</h2></a>
    </div>
    {% endif %}

    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search for products">
        <button id="searchBtn"><i class="fas fa-search"></i></button>
    </div>

    <div class="ss_men_cont">

    </div>
    <ul class="side-menu-content">
        <li><a href="#home">Home<i class="fas fa-chevron-right"></i></a></li>
        <li><a href="#products">Products<i class="fas fa-chevron-right"></i></a></li>
        <li><a href="#categories">Categories<i class="fas fa-chevron-right"></i></a></li>
        <li><a href="#about">About Us<i class="fas fa-chevron-right"></i></a></li>
    </ul>
    <br>
    <br>
    <div class="menu-message">
        <h3>Welcome to <b style="color: #282828e4;">Vibe & Vogue</b></h3>
        <p>Get exclusive access to new collections, special discounts, and more by registering today! Already a
            member?</p>
        {% if not user.is_authenticated %}
        <br>
        <div class="link">
            <a href="{% url 'login' %}" class="login-button">Sign In</a>
            <a href="{% url 'register' %}" class="register-button">Sign Up</a>
        </div>
        {% endif %}
    </div>
</div>

<section class="main-home" id="home">
    <div class="main-text">
        <h5>Winter Collection</h5>
        <h1>New Summer <br> Collection 2025</h1>
        <p>There's Nothing like Trend</p>
        <a href="#" class="main-btn">Shop Now <i class='bx bx-right-arrow-alt'></i></a>
    </div>
</section>
<br>
<br>
<br>
<div class="slider-container" id="categories">
    <div class="slider" id="categorySlider">
        {% for cat in categories %}
        <div class="card" data-category="{{ cat.key }}">
            <div class="card-image" style="background-image: url('{{ cat.img }}')"></div>
            <div class="card-overlay"></div>
            <div class="card-content">
                <h3 class="card-title">{{ cat.title }}</h3>
                <div class="card-accent"></div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
<br>
<h2 class="new-ar" id="products">Best Sellers</h2>
<div class="products">
    {% for product in best_sellers %}
    <a href="{% url 'product_detail' product.pk %}" class="product-card-link">
        <div class="product-card">
            <div class="image-container">
                <img src="{{ product.get_image }}" alt="{{ product.title }}" loading="lazy">
                <div class="favor-btn">
                    <span class="favorite-btn" data-id="{{ product.id }}">
                        <i class='bx bx-heart'></i>
                    </span>
                </div>
            </div>
            <div class="cont-des">
                <h2>{{ product.title }}</h2>
                <p class="price">${{ product.price }}</p>
            </div>
            <p class="description">{{ product.description }}</p>
            <span class="add-to-bag" data-product-id="{{ product.id }}">Add to Bag</span>
        </div>
    </a>
    {% endfor %}
</div>
<br>
<br>
<br>
<section class="about" id="about">
    <div class="main">
        <img src="{% static 'image/about.png' %}">
        <div class="all-text">
            <h4>About Us</h4>
            <h1>Vibe & Vogue — more than just a store</h1>
            <p>We have been living fashion for over 10 years and helping
                people find their style. Our assortment includes only
                high-quality, carefully selected clothing from reliable
                manufacturers. We don't just sell things — we give confidence,
                comfort, and satisfaction with every purchase. Follow the
                trends with us: new collections, fast delivery, and service
                that is always on your side. Choose Vibe & Vogue — and let
                your style speak for you.</p>
        </div>
    </div>
</section>
<br>
<br>
<footer>
    <div class="main-content">
        <div class="left-box">
            <ul>
                <li><a href="#home">Home</a></li>
                <li><a href="#products">Products</a></li>
                <li><a href="#categories">Categories</a></li>
                <li><a href="#about">About Us</a></li>
                <li><a href="/favor-me/">Favorite</a></li>
            </ul>
        </div>
        <div class="center-box">
            <h1>Vibe & Vogue</h1>
        </div>
        <div class="border-top">© 2025 Company, Inc. All rights reserved.</div>
    </div>
</footer>

<script>
    const navLinks = document.querySelectorAll(".navmenu1 .item");

navLinks.forEach(link => {
  link.addEventListener("click", function () {
    navLinks.forEach(item => item.classList.remove("active"));
    this.classList.add("active");
  });
});


    const header = document.querySelector("header");
    window.addEventListener("scroll", () => {
      header.classList.toggle("sticky", window.scrollY > 0);
    });

    document.addEventListener("DOMContentLoaded", () => {
  const menuIcon = document.getElementById("menu-icon");
  const sideMenu = document.getElementById("side-menu");
  const overlay = document.getElementById("overlay");
  const closeIcon = document.getElementById("close-icon");
  const close1 = document.getElementById("close1");
  const header = document.querySelector(".header1");
  const searchIcon = document.querySelector('.search1');
  const searchBox = document.querySelector('.search-box');
  const searchOverlay = document.getElementById('searchOverlay');
  let isScrolled = window.scrollY > 0;

  const updateSticky = () => {
    isScrolled = window.scrollY > 0;
    header.classList.toggle("sticky", isScrolled);
  };
  updateSticky();
  window.addEventListener("scroll", updateSticky);

  const closeMenu = () => {
    sideMenu.classList.remove("active");
    overlay.style.display = "none";
    document.body.classList.remove("no-scroll");
    if (isScrolled) header.classList.remove("menu-open");
  };

  menuIcon.addEventListener("click", () => {
    sideMenu.classList.add("active");
    overlay.style.display = "block";
    document.body.classList.add("no-scroll");
    if (isScrolled) header.classList.add("menu-open");
  });

  close1.addEventListener("click", closeMenu);
  overlay.addEventListener("click", closeMenu);

  const openSearchOverlay = () => {
    closeMenu();
    searchOverlay.style.display = 'flex';
    setTimeout(() => searchOverlay.style.top = '0', 10);
  };

  searchIcon.addEventListener('click', openSearchOverlay);
  searchBox.addEventListener('click', openSearchOverlay);

  closeIcon.addEventListener("click", () => {
    searchOverlay.style.top = '-100%';
    setTimeout(() => searchOverlay.style.display = 'none', 500);
  });

  // 🔽 Ось ця частина додає закриття меню при кліку на якірні посилання
  const anchorLinks = sideMenu.querySelectorAll('a[href^="#"]');
  anchorLinks.forEach(link => {
    link.addEventListener('click', () => {
      closeMenu();
    });
  });
});


    // Search Logic
    document.addEventListener('DOMContentLoaded', () => {
      const searchInput = document.getElementById('searchInput');
      const searchBox = document.querySelector('.search-box');
      const searchBtn = document.getElementById('searchBtn');
      const clearBtn = document.getElementById('clearBtn');
      const searchItems = document.querySelectorAll('.popular-queries .search-item');

      searchBox?.addEventListener('click', () => searchInput?.focus());
      clearBtn?.addEventListener('click', () => searchInput.value = '');

      searchItems.forEach(item => {
        item.addEventListener('click', () => {
          searchInput.value = item.getAttribute('data-query');
        });
      });

      searchBtn?.addEventListener('click', () => {
        const query = searchInput.value.trim();
        if (query) window.location.href = `/search?query=${encodeURIComponent(query)}`;
      });

      searchInput?.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') searchBtn.click();
      });
    });









class CategorySlider {
  constructor() {
    this.slider = document.getElementById('categorySlider');
    this.prevBtn = document.getElementById('prevBtn');
    this.nextBtn = document.getElementById('nextBtn');
    this.indicators = document.getElementById('indicators');

    this.currentTranslate = 0;
    this.prevTranslate = 0;
    this.isDragging = false;
    this.dragMoved = false;
    this.startPos = 0;
    this.animationId = 0;
    this.slideWidth = 344; // 320px + 24px gap

    this.cards = Array.from(this.slider.querySelectorAll('.card'));
    this.totalSlides = this.cards.length;

    this.init();
  }

  init() {
    this.createIndicators();
    this.addEventListeners();
    this.updateButtons();
    this.updateIndicators();

    window.addEventListener('resize', () => this.handleResize());
    this.handleResize();
  }

  createIndicators() {
    this.indicators.innerHTML = '';
    for (let i = 0; i < this.totalSlides; i++) {
      const indicator = document.createElement('button');
      indicator.className = 'indicator';
      indicator.addEventListener('click', () => this.goToSlide(i));
      this.indicators.appendChild(indicator);
    }
  }

  addEventListeners() {
    this.prevBtn.addEventListener('click', () => this.slideToDirection('prev'));
    this.nextBtn.addEventListener('click', () => this.slideToDirection('next'));

    // ПК: мишка
    this.slider.addEventListener('mousedown', this.dragStart.bind(this));
    this.slider.addEventListener('mousemove', this.dragMove.bind(this));
    this.slider.addEventListener('mouseup', this.dragEnd.bind(this));
    this.slider.addEventListener('mouseleave', this.dragEnd.bind(this)); // на випадок виходу з елемента

    // Мобільні пристрої
    this.slider.addEventListener('touchstart', this.dragStart.bind(this), { passive: false });
    this.slider.addEventListener('touchmove', this.dragMove.bind(this), { passive: false });
    this.slider.addEventListener('touchend', this.dragEnd.bind(this));

    this.cards.forEach(card => {
      card.addEventListener('click', (e) => {
        if (this.dragMoved) {
          e.preventDefault();
          return;
        }
        this.handleCardClick(card);
      });
    });

    this.slider.addEventListener('dragstart', e => e.preventDefault());
  }

  handleResize() {
    const containerWidth = this.slider.parentElement.offsetWidth;
    const visibleSlides = Math.floor(containerWidth / this.slideWidth);
    this.maxTranslate = Math.max(0, (this.totalSlides - visibleSlides) * this.slideWidth);

    if (Math.abs(this.currentTranslate) > this.maxTranslate) {
      this.currentTranslate = -this.maxTranslate;
      this.prevTranslate = -this.maxTranslate;
      this.setSliderPosition();
    }

    this.updateButtons();
  }

  getPositionX(e) {
    return e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
  }

  dragStart(e) {
    e.preventDefault(); // важливо для десктопу
    this.isDragging = true;
    this.dragMoved = false;
    this.startPos = this.getPositionX(e);
    this.animationId = requestAnimationFrame(this.animation.bind(this));
    this.slider.classList.add('dragging');
  }

  dragMove(e) {
    if (!this.isDragging) return;
    const currentPosition = this.getPositionX(e);
    const diff = currentPosition - this.startPos;

    if (Math.abs(diff) > 5) this.dragMoved = true;

    this.currentTranslate = this.prevTranslate + diff;
  }

  dragEnd() {
    if (!this.isDragging) return;
    this.isDragging = false;
    cancelAnimationFrame(this.animationId);
    this.slider.classList.remove('dragging');

    const movedBy = this.currentTranslate - this.prevTranslate;

    if (Math.abs(movedBy) > 50) {
      if (movedBy < 0 && Math.abs(this.currentTranslate) < this.maxTranslate) {
        this.setTranslate(this.prevTranslate - this.slideWidth);
      } else if (movedBy > 0 && this.currentTranslate < 0) {
        this.setTranslate(this.prevTranslate + this.slideWidth);
      } else {
        this.setTranslate(this.prevTranslate);
      }
    } else {
      this.setTranslate(this.prevTranslate);
    }

    this.constrainToBounds();
    this.updateButtons();
    this.updateIndicators();
  }

  animation() {
    this.setSliderPosition();
    if (this.isDragging) {
      this.animationId = requestAnimationFrame(this.animation.bind(this));
    }
  }

  setSliderPosition() {
    this.slider.style.transform = `translateX(${this.currentTranslate}px)`;
  }

  setTranslate(value) {
    this.currentTranslate = value;
    this.prevTranslate = value;
    this.setSliderPosition();
  }

  constrainToBounds() {
    if (this.currentTranslate > 0) {
      this.setTranslate(0);
    } else if (this.currentTranslate < -this.maxTranslate) {
      this.setTranslate(-this.maxTranslate);
    }
  }

  slideToDirection(direction) {
    if (direction === 'prev' && this.currentTranslate < 0) {
      const newTranslate = Math.min(0, this.currentTranslate + this.slideWidth);
      this.setTranslate(newTranslate);
    } else if (direction === 'next' && Math.abs(this.currentTranslate) < this.maxTranslate) {
      const newTranslate = Math.max(-this.maxTranslate, this.currentTranslate - this.slideWidth);
      this.setTranslate(newTranslate);
    }

    this.updateButtons();
    this.updateIndicators();
  }

  goToSlide(index) {
    const newTranslate = -index * this.slideWidth;
    const constrainedTranslate = Math.max(-this.maxTranslate, Math.min(0, newTranslate));
    this.setTranslate(constrainedTranslate);
    this.updateButtons();
    this.updateIndicators();
  }

  updateButtons() {
    this.prevBtn.disabled = this.currentTranslate >= 0;
    this.nextBtn.disabled = Math.abs(this.currentTranslate) >= this.maxTranslate;
  }

  updateIndicators() {
    const currentIndex = Math.round(Math.abs(this.currentTranslate) / this.slideWidth);
    const indicatorElements = this.indicators.querySelectorAll('.indicator');

    indicatorElements.forEach((indicator, index) => {
      indicator.classList.toggle('active', index === currentIndex);
    });
  }

  handleCardClick(card) {
    const category = card.dataset.category;
    console.log(`Selected category: ${category}`);

    card.style.transform = 'scale(0.95)';
    setTimeout(() => {
      card.style.transform = '';
    }, 150);
  }
}

document.addEventListener('DOMContentLoaded', () => {
  new CategorySlider();

  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });
  });
});













    document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.favorite-btn').forEach(btn => {
      btn.addEventListener('click', function (e) {
        e.preventDefault();
        const productId = this.dataset.id;

        fetch('/add-to-favorites/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
          },
          body: JSON.stringify({ product_id: productId })
        })
        .then(response => response.json())
        .then(data => {
          if (data.status === 'ok') {
            this.querySelector('i').classList.remove('bx-heart');
            this.querySelector('i').classList.add('bxs-heart');
            this.querySelector('i').style.color = 'black';
          }
        });
      });
    });
  });



function updateCartCount() {
  fetch('/get-cart-count/')
    .then(response => response.json())
    .then(data => {
      const counter = document.querySelector('.cart-count');
      if (counter) {
        counter.textContent = data.count;
      }
    })
    .catch(error => {
      console.error('Помилка при оновленні корзини:', error);
    });
}

document.addEventListener('DOMContentLoaded', function () {
  document.querySelectorAll('.add-to-bag').forEach(button => {
    button.addEventListener('click', function (e) {
      e.preventDefault();
      const productId = this.getAttribute('data-product-id');

      fetch(`/add-to-cart/${productId}/`, {
        method: 'GET',
        headers: {
          'X-Requested-With': 'XMLHttpRequest'
        }
      })
      .then(response => response.json())
      .then(data => {
        // alert(data.message);  <-- цей рядок закоментований або видалений
        updateCartCount();
      });
    });
  });
});

</script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
    AOS.init({
      duration: 300, // тривалість анімації в мс
      once: true     // анімація відбувається тільки один раз
    });
</script>


</body>
</html>